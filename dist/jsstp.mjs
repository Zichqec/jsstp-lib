var t,e=t=>t.toLowerCase(),s=(t,e)=>{var s=t.indexOf(e);return[t[S](0,s),t[S](s+e[b])]},r=e=>(s,r)=>{var i;if(!e.t||!e.t(s,r))return(i=a(r)instanceof String?e.i&&e.i(s,r):e.h&&e.h(s,r))!==t?i:e.u?e.u(s,r):(i=s[r])instanceof Function?i.bind(s):i},i=!!globalThis.window,n=t=>"http://localhost:"+(t??9801),h=i?location.origin:n(process.env.PORT),u=/^\w+:\/\/localhost/.test(h)?M:U,a=Object,o=Proxy,_=a.assign,l="\r\n",g="Get_Supported_Events",c="Has_Event",f=e(g),p=e(c),d="get_simple_caller_of_event",v="trivial_clone",w="default_info",m="default_security_level",y="sstp_version_table",S="substring",b="length",E="available",O="split",T="entries",x="costom_text_send",k="forEach",P="get_caller_of_method",C="unknown_lines",N="get_caller_of_event",$="sendername",F="proxy",j="then",q="SEND",G="get_fmo_infos",I="get_passthrough",M="local",U="external",J="",X="X-SSTP-PassThru-";class A{get keys(){return a.keys(this)}get values(){return a.values(this)}get[T](){return a[T](this)}get[b](){return this.keys[b]}[k](t){this[T][k](([e,s])=>{this[e]=t(s,e)??s})}get[v](){return _(D(),this)}flat_map(t){let e=[];return this[T].map(([s,r])=>e.push(...r instanceof A?r.flat_map(t.bind(t,s)):[t(s,r)])),e}map(t){return this[T].map(([e,s])=>t(s,e))}push(e){return e[k](e=>e?this[e[0]]=e[1]:t),this}}var D=()=>new A;class H extends A{#t;#e;constructor(t,e,s={}){super(),this.#t=J+t,s[b]&&(this.#e=s),_(this,e)}get[C](){return this.#e||[]}get head(){return this.#t}toString(){return[this.#t,...this[C],...this[T].map(([t,e])=>t+": "+e),J,J].join(l)}to_string(){return J+this}toJSON(){return{head:this.#t,[C]:this.#e,body:this[v]}}get status_code(){return+this.#t[O](" ").find(t=>{return(t=+t)==t})}}class V extends H{constructor(e,s,i={}){return super(e,s,i),new o(this,{get:r({i:(e,s)=>X+s in e?e[I](s):t})})}static from_string(t){let e,[r,...i]=t[O](l),n={},h=[];i[b]-=2;for(let t of i){let[r,i]=s(t,": ");/^\w[^\s]*$/.test(r)?n[e=r]=i:e?n[e]+=l+t:h.push(t)}return new V(r,n,h)}[I](t){return this[X+t]}#s;get passthroughs(){return this.#s??=D().push(this.map((e,s)=>s.startsWith(X)?[s.slice(16),e]:t))}get raw(){return this}}class Y extends H{constructor(t){var[t,...r]=t[O](l);super(t,{});for(let t of r)if(t){let[e,r]=s(t,""),[i,n]=s(e,".");(this[i]||=D())[n]=r}}get_uuid_by(t,e){return this.uuids.find(s=>this[s][t]==e)}get_list_of(t){return this.uuids.map(e=>this[e][t])}get uuids(){return this.keys}get[E](){return!!this[b]}toString(){return[this.head,J,...this.flat_map((t,e,s)=>t+"."+e+""+s),J,J].join(l)}toJSON(){return{head:this.head,fmo_infos:this[v]}}}class z{#r;#i;#n;#h;#u;constructor(t){this.#r=t,this[m]=t[m]}async check_event(t,e=this[m]){return this.#n?this.#h[e].includes(t):!!this.#i&&(this.#u[e][t]??=await this.#r[p](t))}get[E](){return this.#i}get fast_query_available(){return this.#n}reset(){return this.clear(),this.init()}async init(){var t=this.#r;return this.#i=await t[p](c),this.#n=this.#i&&await t[p](g),this.#n&&(this.#h=await t[f]()),this}clear(){this.#i=this.#n=!1,this.#u={[M]:{},[U]:{}}}}class B{#a;constructor(e,s){return this.RequestHeader={Origin:h},this[w]={Charset:"UTF-8"},this.host=s,this[$]=e,this[y]={[q]:1.4,NOTIFY:1.1,COMMUNICATE:1.1,EXECUTE:1.2,GIVE:1.1},this[m]=u,this[F]=new o(this,{get:r({i:(e,s)=>s in e[y]?e[P](s):/^On/.test(s)?e[d]((t=>"_"==t[2]?t[S](3):t)(s)):t})})}set host(t){this.#a=t||n()+"/api/sstp/v1"}get host(){return this.#a}set[$](t){this[w].Sender=t||"jsstp-client"}get[$](){return this[w].Sender}row_send(t){return new Promise((e,s)=>{return fetch(this.#a,{method:"POST",headers:this.RequestHeader,body:J+t})[j](t=>200!=t.status?s(t.status):t.text()[j](e),s)})}[x](t,e){return this.row_send(new V(t,{...this[w],...e}))}costom_send(t,e){return this[x](t,e)[j](t=>V.from_string(t))}[P](t){let e=t+" SSTP/"+this[y][t];return _(t=>this.costom_send(e,t),{get_raw:t=>this[x](e,t)})}#o(t,e,s,r){return new o(s,{get:(s,i)=>i in s?s[i]:i==j?(t,e)=>s()[j](t,e):this[r](t+"."+i,e)})}[N](t,e=q){return this.#o(t,e,s=>this[F][e](_({Event:t},s)),N)}[d](t,e=q){return this.#o(t,e,(...s)=>{let r=0,i={};return s[k](t=>i["Reference"+r++]=t),this[N](t,e)(i)},d)}get event(){return new o({},{get:(t,e)=>this[d](e)})}[p](t,e=this[m]){return this.event[c](t,e)[j](({Result:t})=>1==t)}[f](){return this.event[g]()[j](({[M]:t,[U]:e})=>({[M]:(t||J)[O](","),[U]:(e||J)[O](",")}))}[G](){return this[F].EXECUTE.get_raw({Command:"GetFMO"})[j](t=>new Y(t))}[E](){return this[G]()[j](t=>t[E],()=>!1)}[j](t,e){return this[E]()[j](s=>s?t(this):e(),e)}new_event_queryer(){return new z(this).init()}}_(B.prototype,{type:B,base_sstp_info_t:H,sstp_info_t:V,fmo_info_t:Y,ghost_events_queryer_t:z});i=new B;export{H as base_sstp_info_t,i as default,Y as fmo_info_t,z as ghost_events_queryer_t,i as jsstp,B as jsstp_t,V as sstp_info_t}
